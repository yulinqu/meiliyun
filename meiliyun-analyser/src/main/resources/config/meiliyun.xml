<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
        PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
        "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="meiliyun">
    
   	<!-- 插入pvuv -->
     <insert id="insert_pvuv" parameterClass="java.util.List">
   		insert into pvuv(time_range,url,pv,uv) values
	     <iterate  conjunction =",">   
		      <![CDATA[  
	             (#pvuv[].timeRange#, #pvuv[].url#, #pvuv[].pv#,#pvuv[].uv#)
	         ]]>   
	      </iterate>  
	</insert>
	
	 <!-- 插入点击数 -->
     <insert id="insert_pclick" parameterClass="java.util.List">
   		insert into pclick(time_range,url,area,position,pid,count) values
	     <iterate  conjunction =",">   
		      <![CDATA[  
	             (#pclick[].timeRange#, #pclick[].referUrl#,#pclick[].area#,#pclick[].position#,#pclick[].pid#,#pclick[].clickCount#)
	         ]]>   
	      </iterate>  
	</insert>
	
	
	 <select id="get_hour_pvuv" parameterClass="java.util.Map" resultClass="java.util.Map">
	  <![CDATA[ 
	 	select 
	 		str_to_date(time_range, '%Y-%m-%d %H') time_range,
	 		sum(pv) pv,
	 		sum(uv) uv
	 	from pvuv where time_range>=#start_time# and time_range<#end_time#
	 	and url=#url# group by str_to_date(time_range, '%Y-%m-%d %H') order by time_range desc
	 ]]>
    </select>
    
    <select id="get_day_pvuv" parameterClass="java.util.Map" resultClass="java.util.Map">
	  <![CDATA[ 
	 	select 
	 		str_to_date(time_range, '%Y-%m-%d') time_range,
	 		sum(pv) pv,
	 		sum(uv) uv
	 	from pvuv where time_range>=#start_time# and time_range<#end_time#
	 	and url=#url# group by str_to_date(time_range, '%Y-%m-%d') order by time_range desc
	 ]]>
    </select>
    
    <select id="get_month_pvuv" parameterClass="java.util.Map" resultClass="java.util.Map">
	  <![CDATA[ 
	 	select 
	 		str_to_date(time_range, '%Y-%m') time_range,
	 		sum(pv) pv,
	 		sum(uv) uv
	 	from pvuv where time_range>=#start_time# and time_range<#end_time#
	 	and url=#url# group by str_to_date(time_range, '%Y-%m') order by time_range desc
	 ]]>
    </select>
    
    <select id="get_minute_pvuv" parameterClass="java.util.Map" resultClass="java.util.Map">
	  <![CDATA[ 
	 	select 
	 		time_range,
	 		pv,
	 		uv
	 	from pvuv where time_range>=#start_time# and time_range<#end_time# and url=#url# order by time_range desc
	 ]]>
    </select>
    
</sqlMap>
